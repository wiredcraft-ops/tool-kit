---
  #
  # Simple helper for Pipelines to update itself
  #
  - hosts: admin
    vars:
      base_repo: "_CHANGEME_NAME_PATH_"
      pipelines_workspace: /var/lib/pipelines/workspace

  
    tasks:
      - name: Clone the code base
        git:
          repo: "_CHANGEME_REPO_"
          dest: "{{ base_repo }}"
          version: "master"
          track_submodules: yes
          accept_hostkey: yes
          force: yes
  
      - name: Update Pipelines
        become: true
        shell: |
          for pipeline in $(ls {{ base_repo }}/devops/pipelines/) 
          do 
            ln -sf {{ base_repo }}/devops/pipelines/$pipeline 
          done
        args:
          chdir: "{{ pipelines_workspace }}" 
